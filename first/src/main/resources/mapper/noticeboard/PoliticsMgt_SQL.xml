<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="politicsBoardMgtDAO">
	
	<!-- 사용자 조회  -->
	<select id="selectUserInfo" parameterType="hashmap" resultType="hashmap">
	 SELECT USER_ID as userId,
	       USER_OS as userOs,
	       USER_HW as userHw,
	       REG_DT as regDt,
	       DROP_DT as dropDt, 
	       USER_ACTIVE_FG as userActiveFg
	FROM TB_USER
	where 1=1
	 <if test="userId != null">
		and USER_ID = #{userId}
	</if>	
	</select>
	
	<!--  게시판등록 -->
	<insert id="insertBoard" parameterType="hashmap" useGeneratedKeys="true" keyProperty="headSeq">
		<selectKey keyProperty="headSeq" resultType="int" order="BEFORE" >
			SELECT ifnull(MAX(HEAD_SEQ),0)+1 FROM TB_BOARD_HEAD
		</selectKey>
		<![CDATA[
			INSERT INTO TB_BOARD_HEAD
			(
				HEAD_SEQ,
				USER_ID,
				USER_NM,
				BOARD_CD,
				BOARD_TITLE,
				REG_DT,
				LST_CHG_DT,
				BOARD_ACTIVE_FG,
				BOARD_BODY1,
				BOARD_BODY2,
				BOARD_SEARCH_CNT,
				BOARD_BEST_CNT
			)
			VALUES
			(
				#{headSeq},
				#{userId},
				#{userNm},
				#{boardCd},
				#{boardTitle},
				date_format(now(), '%Y%m%d%h%i%S'),
				date_format(now(), '%Y%m%d%h%i%S'),
				#{boardActiveFg},
				#{boardBody1},
				#{boardBody2},
				0,
				0
			)
		]]>
	</insert>
	<!-- 게시판목록 조회 -->
	<select id="selectPoliticsBoardInfo" parameterType="hashmap" resultType="hashmap">
		SELECT  A.HEAD_SEQ 									AS headSeq
				,A.USER_ID 									AS userId
				,A.USER_NM 									AS userNm
				,A.BOARD_CD 								AS boardCd
				,A.BOARD_TITLE	    						AS boardTilte
				,date_format(A.REG_DT, '%Y%m%d%h%i%S') 		AS regDt
				,date_format(A.LST_CHG_DT, '%Y%m%d%h%i%S')	AS lstChgDt
				,A.BOARD_ACTIVE_FG		 					AS boardActiveFg
				,A.BOARD_BODY1 								AS boardBody1
				,A.BOARD_BODY2 								AS boardBody2
				,A.BOARD_SEARCH_CNT 						AS boardSearchCnt
				,A.BOARD_BEST_CNT 							AS boardBestCnt
                ,CASE WHEN B.CNT IS NULL 
                  THEN 0 ELSE B.CNT END	   					 AS replyCnt
		FROM TB_BOARD_HEAD A  left outer  join ( SELECT DETAIL_SEQ, COUNT(1) AS CNT 
											      FROM TB_BOARD_DETAIL 
											      GROUP BY DETAIL_SEQ) B
				ON (A.HEAD_SEQ = B.DETAIL_SEQ)		
		WHERE 1=1
			<if test="boardCd != null">
				AND A.BOARD_CD = #{boardCd}
			</if>	 
	</select>
</mapper>